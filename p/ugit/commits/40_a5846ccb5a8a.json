{"commits": [{"oid": "547bed67b44f556e981bc4d247b37ad7b69ecf99", "id": "reset-move-head", "title": "reset: Move HEAD", "message": "<p><code>ugit reset</code> will allow us to move HEAD to an OID of our choice. This is useful if we want to undo a commit. For example, if we have this situation:</p>\n<pre><code>        7fa39 ac120\n            v     v\no-----o-----o-----o\n                  ^\n                  master &lt;--- HEAD</code></pre>\n<p>(<strong>Note</strong>: The OIDs are abbreviated from now on for clarity, the full OID is longer.)</p>\n<p>We can run this command to undo commit <em>ac120</em>:</p>\n<pre><code>$ ugit reset 7fa39</code></pre>\n<p>This will point master to <em>7fa49</em>, effectively erasing the latest (<em>ac120</em>) commit:</p>\n<pre><code>        7fa39 ac120\n            v     v\no-----o-----o-----o\n            ^\n            master &lt;--- HEAD</code></pre>\n<p>Note that not only HEAD moved, but also master (Since HEAD is a symbolic ref that points to master).</p>\n<p>Now if we make another commit, we will get this:</p>\n<pre><code>        7fa39 ac120\n            v     v\no-----o-----o-----o\n             \\\n              ----o\n                  ^\n                  master &lt;--- HEAD</code></pre>\n<p>And commit <em>ac120</em> is effectively removed from master.</p>\n<p>You might wonder what is the difference between <code>checkout</code> and <code>reset</code>, since they both seem to move HEAD to another commit... Couldn't we just use <code>ugit checkout 7fa39</code> to do the same? Well, no. Unlike <code>reset</code>, <code>checkout</code> moves the HEAD without dereferencing it (by passing deref=False). So if we would use checkout we will get:</p>\n<pre><code>        7fa39 ac120\n            v     v\no-----o-----o-----o\n            ^     ^\n          HEAD    master</code></pre>\n<p><code>checkout</code> leaves master at the previous place. That's why we need <code>reset</code>, to move the actual branch and not just HEAD.</p>\n<p>Note that we can also undo multiple commits if we move HEAD a few commits back, like this:</p>\n<pre><code>  0dda2 7fa39 ac120\n      v     v     v\no-----o-----o-----o\n                  ^\n                  master &lt;--- HEAD\n\n$ ugit reset 0dda2</code></pre>\n<p>The end result is undoing both 7fa39 and ac120:</p>\n<pre><code>  0dda2 7fa39 ac120\n      v     v     v\no-----o-----o-----o\n      ^\n      master &lt;--- HEAD</code></pre>\n<p>Another point about <code>reset</code>: Even though I talked about this command like some kind of undo command, it's important to remember that <code>reset</code> just moves HEAD to a specified state. In practice this can be used for undoing a commit, but <code>reset</code> is not a generic undo command. It can be used to undo any number of commits from the tip of the branch (by moving HEAD to an earlier commit), but it can't undo arbitrary commits.</p>\n<p>For example if we want to undo <em>7fa39</em> only, we can't do it with <code>reset</code>:</p>\n<pre><code>  0dda2 7fa39 ac120\n      v     v     v\no-----o-----o-----o\n                  ^\n                  master &lt;--- HEAD</code></pre>\n<p>If we move master to <em>0dda2</em>, we will undo <em>ac120</em> and <em>7fa39</em>, which is not the same as undoing <em>7fa39</em> only. Thus <code>reset</code> can't be used to remove a commit from the middle of the history.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [120, 121, 122, 123], "hunks": [{"title": "@@ -117,6 +117,10 @@ def checkout (name):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"117\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"119\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"120\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"121\"><span class=\"d-s\">+ </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"122\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"123\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"124\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [70, 71, 72, 73, 169, 170, 171, 172], "hunks": [{"title": "@@ -67,6 +67,10 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"67\"><span class=\"d-s\">  </span>    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\"><span class=\"d-s\">  </span>    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"70\"><span class=\"d-s\">+ </span>    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"71\"><span class=\"d-s\">+ </span>    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"72\"><span class=\"d-s\">+ </span>    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"73\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"74\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"75\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}, {"title": "@@ -162,3 +166,7 @@ def status (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"166\"><span class=\"d-s\">  </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"167\"><span class=\"d-s\">  </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"168\"><span class=\"d-s\">  </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"169\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"170\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"171\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"172\"><span class=\"d-s\">+ </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "53104e26719d9af8897fc8704ce07dbf8a886281", "ugit/cli.py": "b56613b28b022968fd912389e2d09f370034bc9a", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a"}}, {"oid": "1a56eb1640ef9a3eedf6ee289849beeb14ec987d", "id": "show-commit-message", "title": "show: Print commit message", "message": "<p>So far, from the user's perspective, commit objects are opaque. The user can see the commit message using <code>log</code> or <code>cat-file</code>, and maybe the user can read the tree object associated with the commit, but that's basically it.</p>\n<p>Most importantly, the user can't see the changes between commits (also known as diffs). As you saw, Git stores the snapshot of the entire directory for each commit, not the diffs.</p>\n<p>Seeing diffs is a very important feature in a version control system, since usually when reviewing commits the diff is the part you use to judge the content of the commit.</p>\n<p>We will add a <code>ugit show</code> CLI command which will print a commit object for us in a useful way - the commit message and the textual diff from the last commit.</p>\n<p>In this change, let's create a new CLI command for <code>show</code>, and just print the commit message to get started. We will print it in the same format as <code>log</code>, so let's refactor this to <code>_print_commit</code>.</p>\n<p>(Note: in Git, <code>git show</code> can show various types of objects. In ugit, <code>ugit show</code> will just work for commit objects, to simplify the code)</p>\n", "diff": {"ugit/cli.py": {"changed_lines": [50, 51, 52, 53, 108, 109, 110, 111, 112, 113, 114, 122, 123, 125, 126, 127, 128, 129], "hunks": [{"title": "@@ -47,6 +47,10 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"47\"><span class=\"d-s\">  </span>    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\"><span class=\"d-s\">  </span>    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"50\"><span class=\"d-s\">+ </span>    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"51\"><span class=\"d-s\">+ </span>    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"52\"><span class=\"d-s\">+ </span>    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"53\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"54\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}, {"title": "@@ -101,6 +105,13 @@ def commit (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"105\"><span class=\"d-s\">  </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"106\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"107\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"108\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"109\"><span class=\"d-s\">+ </span>    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line d-a\" data-line=\"110\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"111\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"112\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"113\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"114\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"115\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"116\"><span class=\"d-s\">  </span>    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"117\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}, {"title": "@@ -108,11 +119,14 @@ def log (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"119\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"120\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"121\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"122\"><span class=\"d-s\">+ </span>        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"123\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"124\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"125\"><span class=\"d-s\">- </span>        <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line d-r\" data-line=\"125\"><span class=\"d-s\">- </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"125\"><span class=\"d-s\">- </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line d-r\" data-line=\"125\"><span class=\"d-s\">- </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"125\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"126\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"127\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span>\n</span><span class=\"line d-a\" data-line=\"128\"><span class=\"d-s\">+ </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"129\"><span class=\"d-s\">+ </span>    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"131\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"132\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "53104e26719d9af8897fc8704ce07dbf8a886281", "ugit/cli.py": "c411e360d7a0d31009c130dcc75afb1bec7584de", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a"}}, {"oid": "c6f5f02511a802596f161bb1f633b4c2f2ad155e", "id": "show-changed-files", "title": "show: List changed files in commit", "message": "<p>Let's first figure out which files were changed by the commit.</p>\n<p>We will compare the tree of the commit to the tree of its parent commit. If a file has one OID in the former tree and a different OID in the latter tree, it means that the file was changed (identical files would have had the same OID, since the OID is a hash over the content).</p>\n<p>Let's create a new module - <em>diff.py</em>. This module will contain the code that deals with computing differences between objects. We will implement an important function called <code>compare_trees()</code>, this function will take a list of trees and will return them grouped by filename. This way, for each file we can get all its OIDs in the different trees.</p>\n<p>Using <code>diff.compare_trees()</code>, the task of displaying all changed files is straightforward. We will create <code>diff.diff_trees()</code> that takes two trees, compares them and return all entries that have different OIDs. Then what is left is to call <code>diff_trees()</code> from <code>show</code> with the correct trees (of the commit we want to show and its parent).</p>\n", "diff": {"ugit/cli.py": {"changed_lines": [9, 130, 131, 132, 133, 135, 136, 137], "hunks": [{"title": "@@ -6,6 +6,7 @@ import textwrap", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"6\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line d-a\" data-line=\"9\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"11\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"12\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}, {"title": "@@ -126,7 +127,14 @@ def show (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"127\"><span class=\"d-s\">  </span>    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\"><span class=\"d-s\">  </span>        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"129\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"130\"><span class=\"d-s\">+ </span>    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line d-a\" data-line=\"131\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"132\"><span class=\"d-s\">+ </span>        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line d-a\" data-line=\"133\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"134\"><span class=\"d-s\">  </span>    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"135\"><span class=\"d-s\">+ </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line d-a\" data-line=\"136\"><span class=\"d-s\">+ </span>        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"137\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"139\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"140\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}, "ugit/diff.py": {"changed_lines": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19], "hunks": [{"title": "@@ -0,0 +1,19 @@", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line d-a\" data-line=\"1\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line d-a\" data-line=\"2\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"3\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"4\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"5\"><span class=\"d-s\">+ </span>    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span> <span class=\"p\">(</span><span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"6\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">tree</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"7\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"8\"><span class=\"d-s\">+ </span>            <span class=\"n\">entries</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line d-a\" data-line=\"9\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"10\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oids</span> <span class=\"ow\">in</span> <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"11\"><span class=\"d-s\">+ </span>        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"12\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"13\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"14\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"15\"><span class=\"d-s\">+ </span>    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line d-a\" data-line=\"16\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"17\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"18\"><span class=\"d-s\">+ </span>            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;changed: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"19\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "53104e26719d9af8897fc8704ce07dbf8a886281", "ugit/cli.py": "5ecdcc7c76a7b692947c57b28381c81ea59e7f16", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "61028beb583bad641710179746339d97dbb51b7c"}}, {"oid": "2151708074720294a80aba37e94f2f457de8351c", "id": "show-diff", "title": "show: Print diff of commit", "message": "<p>Finally, instead of just printing the changed files in a commit, let's print the actual diff (diff is the format with pluses and minuses at the beginning of the line).</p>\n<p>Hopefully you're already very familiar with the diff format because that's the format I used to encode the changes you're reading here :)</p>\n<p>We will create a function <code>diff_blobs()</code> that will take two blob OIDs and return the diff between them. For each changed file, we will call <code>diff_blobs()</code> with the OID of that file in the parent commit and the OID in the current commit.</p>\n<p>Since the difference between the parent commit and the current commit is exactly the change that was performed in the commit, we will effectively print all lines changed by the commit.</p>\n<p>For <code>diff_blobs()</code>, we're going to use an external Unix utility called \"diff\". It receives two files as arguments and prints the differences between them in diff format, just like we need. We'll need to read the blobs from the object database and write them to a temporary file, which will be given to \"diff\" utility.</p>\n<p>Since \"diff\"'s output is a byte string, we will output it raw to stdout using <code>sys.stdout.buffer.write()</code>.</p>\n<p>(When invoking \"diff\" utility, I passed some extra options (--unified, --show-c-function, --label) to make the diff look prettier. You can read about these options in the man page of diff.)</p>\n<p>And that's it! We can actually run <code>ugit show</code> on any commit and see the full content of the commit. Try it!</p>\n", "diff": {"ugit/cli.py": {"changed_lines": [137, 138], "hunks": [{"title": "@@ -134,7 +134,8 @@ def show (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"134\"><span class=\"d-s\">  </span>    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\"><span class=\"d-s\">  </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"136\"><span class=\"d-s\">  </span>        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line d-r\" data-line=\"137\"><span class=\"d-s\">- </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"137\"><span class=\"d-s\">+ </span>    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"138\"><span class=\"d-s\">+ </span>    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"140\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"141\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}, "ugit/diff.py": {"changed_lines": [1, 2, 4, 5, 6, 20, 23, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41], "hunks": [{"title": "@@ -1,4 +1,9 @@", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line d-a\" data-line=\"1\"><span class=\"d-s\">+ </span><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line d-a\" data-line=\"2\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line d-a\" data-line=\"4\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">tempfile</span> <span class=\"kn\">import</span> <span class=\"n\">NamedTemporaryFile</span> <span class=\"k\">as</span> <span class=\"n\">Temp</span>\n</span><span class=\"line d-a\" data-line=\"5\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"6\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}, {"title": "@@ -12,8 +17,25 @@ def compare_trees (*trees):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"17\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"19\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"20\"><span class=\"d-s\">- </span>    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line d-a\" data-line=\"20\"><span class=\"d-s\">+ </span>    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"21\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\"><span class=\"d-s\">  </span>        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"23\"><span class=\"d-s\">- </span>            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;changed: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"23\"><span class=\"d-s\">+ </span>            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"n\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line d-a\" data-line=\"25\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"26\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"27\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"28\"><span class=\"d-s\">+ </span>    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_from</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_to</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"29\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"p\">)):</span>\n</span><span class=\"line d-a\" data-line=\"30\"><span class=\"d-s\">+ </span>            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"31\"><span class=\"d-s\">+ </span>                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"32\"><span class=\"d-s\">+ </span>                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"33\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"34\"><span class=\"d-s\">+ </span>        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line d-a\" data-line=\"35\"><span class=\"d-s\">+ </span>            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--unified&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--show-c-function&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line d-a\" data-line=\"36\"><span class=\"d-s\">+ </span>             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;a/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line d-a\" data-line=\"37\"><span class=\"d-s\">+ </span>             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;b/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">],</span>\n</span><span class=\"line d-a\" data-line=\"38\"><span class=\"d-s\">+ </span>            <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"39\"><span class=\"d-s\">+ </span>            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"40\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"41\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "53104e26719d9af8897fc8704ce07dbf8a886281", "ugit/cli.py": "78335fe018b50119420baafcf1da50557afbcc2b", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "8fe2131a4a01c92bee261ad1c82d93795ef42a03"}}, {"oid": "06e09354051173bdf06cac640bbb81d04fc05e57", "id": "diff-working-tree", "title": "diff: Compare working tree to a commit", "message": "<p>Let's impelement another useful command that will make use of <em>diff</em> - a command that will display what was changed in the working directory since the last commit. This is useful if you don't remember exactly what you have changed or if you want to make sure that you're not introducing any unintended changes to a commit by mistake. The command will be called <code>diff</code>, to mirror Git's name.</p>\n<p>Our implementation of <code>diff</code> will use <code>diff.diff_trees()</code> that we created earlier for <code>show</code>. This time, we will ask <code>diff_trees()</code> to compare the \"working tree\" with the tree of some commit. The \"working tree\" is a dictionary that describes the files in the working directory.</p>\n<p>We will implement <code>get_working_tree()</code>, which will walk over all files in the working directory, put them in the object database and create a dict that holds all the OIDs. This dictionary will represent a \"tree\" without actually writing a tree object.</p>\n<p>(It may seem strange to put all files in the object database each time just for calculating a diff, but it will be needed later anyway, when we implement something called the \"index\".)</p>\n<p>Then let's create a CLI command <code>diff</code> which will just compare the current \"working tree\" to a commit tree (by default to HEAD, but it can be any commit we want).</p>\n", "diff": {"ugit/base.py": {"changed_lines": [63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74], "hunks": [{"title": "@@ -60,6 +60,18 @@ def get_tree (oid, base_path=''):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"60\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"62\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"63\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">get_working_tree</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"64\"><span class=\"d-s\">+ </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line d-a\" data-line=\"65\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"66\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"67\"><span class=\"d-s\">+ </span>            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"68\"><span class=\"d-s\">+ </span>            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"69\"><span class=\"d-s\">+ </span>                <span class=\"k\">continue</span>\n</span><span class=\"line d-a\" data-line=\"70\"><span class=\"d-s\">+ </span>            <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"71\"><span class=\"d-s\">+ </span>                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line d-a\" data-line=\"72\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line d-a\" data-line=\"73\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"74\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"75\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"76\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\"><span class=\"d-s\">  </span>        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [55, 56, 57, 58, 145, 146, 147, 148, 149, 150, 151, 152], "hunks": [{"title": "@@ -52,6 +52,10 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"52\"><span class=\"d-s\">  </span>    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\"><span class=\"d-s\">  </span>    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"55\"><span class=\"d-s\">+ </span>    <span class=\"n\">diff_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"56\"><span class=\"d-s\">+ </span>    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">_diff</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"57\"><span class=\"d-s\">+ </span>    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"58\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"59\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\"><span class=\"d-s\">  </span>    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}, {"title": "@@ -138,6 +142,14 @@ def show (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"142\"><span class=\"d-s\">  </span>    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"144\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"145\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">_diff</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"146\"><span class=\"d-s\">+ </span>    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line d-a\" data-line=\"147\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"148\"><span class=\"d-s\">+ </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line d-a\" data-line=\"149\"><span class=\"d-s\">+ </span>    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"150\"><span class=\"d-s\">+ </span>    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"151\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"152\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"153\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"154\"><span class=\"d-s\">  </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "f3036e83f9ba1486a2f0cf941b7a89dd9eb39555", "ugit/cli.py": "14f68302425652b40b27ee836357461763587767", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "8fe2131a4a01c92bee261ad1c82d93795ef42a03"}}, {"oid": "d8d329761accb8245d5737f726844cd808b8d3b1", "id": "status-changed-files", "title": "status: Show changed files", "message": "<p>The command <code>diff</code> that we implemented ealier is useful, but sometimes it might be too verbose (if you've changed a lot of lines). Let's implement a simpler version as part of <code>status</code>, which will just list the changed files without listing the full diff.</p>\n<p>In <em>diff.py</em>, we will add <code>iter_changed_files()</code>, which will take two trees and output all changed paths along with the change type (deleted, created, modified). Then in <code>status</code> we will call <code>iter_changed_files()</code>, comparing HEAD to the working tree (just like <code>diff</code> does).</p>\n", "diff": {"ugit/cli.py": {"changed_lines": [205, 206, 207, 208, 209, 210], "hunks": [{"title": "@@ -202,6 +202,12 @@ def status (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"202\"><span class=\"d-s\">  </span>    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"203\"><span class=\"d-s\">  </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"204\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"205\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Changes to be committed:</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"206\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD_tree</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line d-a\" data-line=\"207\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">HEAD_tree</span><span class=\"p\">),</span>\n</span><span class=\"line d-a\" data-line=\"208\"><span class=\"d-s\">+ </span>                                                 <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">()):</span>\n</span><span class=\"line d-a\" data-line=\"209\"><span class=\"d-s\">+ </span>        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">action</span><span class=\"si\">:</span><span class=\"s1\">&gt;12</span><span class=\"si\">}</span><span class=\"s1\">: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"210\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"211\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"212\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"213\"><span class=\"d-s\">  </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}, "ugit/diff.py": {"changed_lines": [19, 20, 21, 22, 23, 24, 25, 26, 27], "hunks": [{"title": "@@ -16,6 +16,15 @@ def compare_trees (*trees):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"16\"><span class=\"d-s\">  </span>        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"17\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"18\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"19\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"20\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"21\"><span class=\"d-s\">+ </span>        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"22\"><span class=\"d-s\">+ </span>            <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;new file&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_from</span> <span class=\"k\">else</span>\n</span><span class=\"line d-a\" data-line=\"23\"><span class=\"d-s\">+ </span>                      <span class=\"s1\">&#39;deleted&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_to</span> <span class=\"k\">else</span>\n</span><span class=\"line d-a\" data-line=\"24\"><span class=\"d-s\">+ </span>                      <span class=\"s1\">&#39;modified&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"25\"><span class=\"d-s\">+ </span>            <span class=\"k\">yield</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span>\n</span><span class=\"line d-a\" data-line=\"26\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"27\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"28\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\"><span class=\"d-s\">  </span>    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"30\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "f3036e83f9ba1486a2f0cf941b7a89dd9eb39555", "ugit/cli.py": "df0fef94e58efd643a5575ad7a62d60cec7811e9", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "56ffdf9e989059eba532f997dfff4720b8c994c4"}}, {"oid": "0aabc5d3178f2043472b0a79e40ef0216937aad5", "id": "merge-command", "title": "merge: Create command", "message": "<p>Up until now we have implemented good support for developing different branches of code in parallel. We could easily create new branches and switch between them. Now let's bring the parallel branches back together. This is known as merging.</p>\n<p>This is useful if multiple people develop code in parallel and they want to unite their changes into one commit. For example if we have:</p>\n<pre><code>                HEAD\n                v\no---o---o---o---o\n     \\\n      --o---o\n            ^\n            some-branch</code></pre>\n<p>And we merge HEAD into <em>some-branch</em>, we should get:</p>\n<pre><code>o---o---o---o---o\n     \\           \\\n      --o---o-----o &lt; HEAD\n            ^\n            some-branch</code></pre>\n<p>This is the big picture and the end goal, it will take us some time to get there in small steps. Please keep that picture in mind as we implement <code>merge</code>.</p>\n<p>In this change we've just created an empty <code>merge</code> command to get us started.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [136, 137, 138, 139, 140], "hunks": [{"title": "@@ -133,6 +133,11 @@ def reset (oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"133\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"134\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"135\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"136\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"137\"><span class=\"d-s\">+ </span>    <span class=\"c1\"># TODO merge HEAD into other</span>\n</span><span class=\"line d-a\" data-line=\"138\"><span class=\"d-s\">+ </span>    <span class=\"k\">pass</span>\n</span><span class=\"line d-a\" data-line=\"139\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"140\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"141\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\"><span class=\"d-s\">  </span>    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [83, 84, 85, 86, 218, 219, 220, 221], "hunks": [{"title": "@@ -80,6 +80,10 @@ def parse_args ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"80\"><span class=\"d-s\">  </span>    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"81\"><span class=\"d-s\">  </span>    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"83\"><span class=\"d-s\">+ </span>    <span class=\"n\">merge_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;merge&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"84\"><span class=\"d-s\">+ </span>    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">merge</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"85\"><span class=\"d-s\">+ </span>    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"86\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"87\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"88\"><span class=\"d-s\">  </span>\n</span></code></pre></div>\n"}, {"title": "@@ -211,3 +215,7 @@ def status (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"215\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"216\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"217\"><span class=\"d-s\">  </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"218\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"219\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"220\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"221\"><span class=\"d-s\">+ </span>    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "a329d38660916137f6d32ef3becc2dfb31205c55", "ugit/cli.py": "60b4ee0ce265702b84e5bd969dbc8d6314fc6c5a", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "56ffdf9e989059eba532f997dfff4720b8c994c4"}}, {"oid": "74661895cb0bff9785601e2d701dc0fd43d52064", "id": "merge-working-directory", "title": "merge: Merge in working directory", "message": "<p>We'll continue with the previous example:</p>\n<pre><code>                HEAD\n                v\no---o---o---o---o\n     \\\n      --o---o\n            ^\n            some-branch</code></pre>\n<p>As you remember, we want to merge HEAD and <em>some-branch</em>. Assume that both HEAD and <em>some-branch</em> have a file named <em>main.py</em> in their trees. When merging, we want to create a new <em>main.py</em> that will contain the content of both HEAD's <em>main.py</em> and <em>some-branch</em>'s <em>main.py</em>.</p>\n<p>Here's HEAD's <em>main.py</em>:</p>\n<pre><code>def main ():\n    print (*This functions is cool*)\n    print (&quot;It prints stuff&quot;)\n    print (&quot;It can even return a number:&quot;)\n    return 7</code></pre>\n<p>Here's <em>some-branch</em>'s <em>main.py</em>:</p>\n<pre><code>def main ():\n    print (&quot;1+1 = 2&quot;)\n    print (&quot;This functions is cool&quot;)\n    print (&quot;It prints stuff&quot;)</code></pre>\n<p>You can see that they have these lines in common:</p>\n<pre><code>def main ():\n    print (&quot;This functions is cool&quot;)\n    print (&quot;It prints stuff&quot;)</code></pre>\n<p>And also each has some unique lines. When merging them together, we would ideally arrive to a combined <em>main.py</em> that looks like this:</p>\n<pre><code>def main ():\n    print (&quot;1+1 = 2&quot;)\n    print (&quot;This functions is cool&quot;)\n    print (&quot;It prints stuff&quot;)\n    print (&quot;It can even return a number:&quot;)\n    return 7</code></pre>\n<p>As you can see the common lines are still there and we've also added the unique lines from HEAD and <em>some-branch</em>.</p>\n<p>The <code>diff</code> shell command that we've used earlier can actually do this merging. The command <code>diff -DHEAD file1 file2</code> outputs merged version of file1 and file2. If we run <code>diff -DHEAD</code> on our two versions of main.py we would get:</p>\n<pre><code>def main ():\n#ifdef HEAD\n    print (&quot;1+1 = 2&quot;)\n#endif /* HEAD */\n    print (&quot;This functions is cool&quot;)\n    print (&quot;It prints stuff&quot;)\n#ifndef HEAD\n    print (&quot;It can even return a number:&quot;)\n    return 7\n#endif /* ! HEAD */</code></pre>\n<p>Which is pretty close to what we want! (There are the \"#ifdef\" lines which mark where each line came from, they add some noise but we will ignore them for now. We will fix that later.)</p>\n<p>The example above was for individual files. Let's write some logic to merge two full trees together. As you remember, we had <code>base.read_tree()</code> command which takes a tree and extract it into the working directory. We will now create <code>base.read_tree_merged()</code> which will take two trees and extract a merged version of them into the working directory.</p>\n<p>We'll need a helper function that calls the <code>diff</code> shell command. For that we will create <code>diff.merge_blobs()</code> that gets two OIDs and returns their merged content.</p>\n<p>Then we will create <code>diff.merge_trees()</code>, which gets two trees and in turn calls <code>diff.merge_blobs()</code> to merge each two files in the trees, outputting one merged tree.</p>\n<p><code>base.read_tree_merged()</code> just calls <code>diff.merge_trees()</code> and writes the resulting merged tree to the working directory.</p>\n<p>And finally, to kick things off, <code>base.merge()</code> takes the tree of the HEAD and the tree of the branch we want to merge with and calls <code>base.read_tree_merged()</code>.</p>\n<p>Note that at this stage we didn't create any merge commits like shown in the diagrams, we've just took two branches and merged them in the working directory. This isn't super useful at this stage, but it's the first step. Also, the <code>diff</code> command adds all these #ifdefs so the merge isn't very usable at this stage, but we will address this later.</p>\n<p>This commit is actually pretty complicated, please pause and make sure that you understood what's going on here.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [9, 103, 104, 105, 106, 107, 108, 109, 110, 146, 147, 148, 149, 150, 151, 152], "hunks": [{"title": "@@ -6,6 +6,7 @@ import string", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"6\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"d-s\">  </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line d-a\" data-line=\"9\"><span class=\"d-s\">+ </span><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"11\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"12\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span></code></pre></div>\n"}, {"title": "@@ -99,6 +100,14 @@ def read_tree (tree_oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"100\"><span class=\"d-s\">  </span>            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"102\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"103\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"104\"><span class=\"d-s\">+ </span>    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"105\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">blob</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">merge_trees</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">),</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_other</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line d-a\" data-line=\"106\"><span class=\"d-s\">+ </span>        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;./</span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"107\"><span class=\"d-s\">+ </span>        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"108\"><span class=\"d-s\">+ </span>            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">blob</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"109\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"110\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"111\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"112\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span></code></pre></div>\n"}, {"title": "@@ -134,8 +143,13 @@ def reset (oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"143\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"144\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"145\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"146\"><span class=\"d-s\">- </span>    <span class=\"c1\"># TODO merge HEAD into other</span>\n</span><span class=\"line d-r\" data-line=\"146\"><span class=\"d-s\">- </span>    <span class=\"k\">pass</span>\n</span><span class=\"line d-a\" data-line=\"146\"><span class=\"d-s\">+ </span>    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"147\"><span class=\"d-s\">+ </span>    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span>\n</span><span class=\"line d-a\" data-line=\"148\"><span class=\"d-s\">+ </span>    <span class=\"n\">c_HEAD</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"149\"><span class=\"d-s\">+ </span>    <span class=\"n\">c_other</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"150\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"151\"><span class=\"d-s\">+ </span>    <span class=\"n\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">c_HEAD</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">c_other</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"152\"><span class=\"d-s\">+ </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Merged in working tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"153\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"154\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"155\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}, "ugit/diff.py": {"changed_lines": [51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74], "hunks": [{"title": "@@ -48,3 +48,27 @@ def diff_blobs (o_from, o_to, path='blob'):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"48\"><span class=\"d-s\">  </span>            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"49\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"50\"><span class=\"d-s\">  </span>        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line d-a\" data-line=\"51\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"52\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"53\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">merge_trees</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"54\"><span class=\"d-s\">+ </span>    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line d-a\" data-line=\"55\"><span class=\"d-s\">+ </span>    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"56\"><span class=\"d-s\">+ </span>        <span class=\"n\">tree</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">merge_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"57\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">tree</span>\n</span><span class=\"line d-a\" data-line=\"58\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"59\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"60\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">merge_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"61\"><span class=\"d-s\">+ </span>    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_HEAD</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_other</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"62\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">f_HEAD</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_other</span><span class=\"p\">,</span> <span class=\"n\">f_other</span><span class=\"p\">)):</span>\n</span><span class=\"line d-a\" data-line=\"63\"><span class=\"d-s\">+ </span>            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"64\"><span class=\"d-s\">+ </span>                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line d-a\" data-line=\"65\"><span class=\"d-s\">+ </span>                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"66\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"67\"><span class=\"d-s\">+ </span>        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line d-a\" data-line=\"68\"><span class=\"d-s\">+ </span>            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line d-a\" data-line=\"69\"><span class=\"d-s\">+ </span>             <span class=\"s1\">&#39;-DHEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_HEAD</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line d-a\" data-line=\"70\"><span class=\"d-s\">+ </span>             <span class=\"n\">f_other</span><span class=\"o\">.</span><span class=\"n\">name</span>\n</span><span class=\"line d-a\" data-line=\"71\"><span class=\"d-s\">+ </span>            <span class=\"p\">],</span> <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"72\"><span class=\"d-s\">+ </span>            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line d-a\" data-line=\"73\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"74\"><span class=\"d-s\">+ </span>        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "0639a0df99b6524dd11c289cdc9cc40c77ff7418", "ugit/cli.py": "60b4ee0ce265702b84e5bd969dbc8d6314fc6c5a", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "e740248bc87e18bd244ca219330df3c4e7ac19cf"}}, {"oid": "8e93eeba541c2ccf10ebe5ba1be8a9a00dcca224", "id": "support-multiple-parents", "title": "merge: Support multiple parents", "message": "<p>Do you remember that the merge looked like this?</p>\n<pre><code>o---o---o---o---o\n     \\           \\\n      --o---o-----o &lt; HEAD\n            ^\n            some-branch</code></pre>\n<p>The HEAD commits is a commit that merges two commits together, and therefore the HEAD commit has two parent commits. Right now ugit doesn't support that, so we will extend the commit object to optionally support multiple parents.</p>\n<p>The <code>Commit</code> object in <em>base.py</em> will now contain a list of parents rather than a single parent.</p>\n<p>The important modification is in <code>base.get_commit()</code>, which parses commit objects: For each \"parent\" line that we encounter, we would append it to the list of parents. So if the commit has one parent, the list will contain one element. If the commit has multiple parents, the list will contain all parents. If the commit has no parents (the first commit), the list will be empty.</p>\n<p>The rest of the modifications are simple refactoring to support the new <code>Commit</code> object.</p>\n", "diff": {"ugit/base.py": {"changed_lines": [181, 185, 194, 199, 214, 215, 216, 217], "hunks": [{"title": "@@ -178,11 +178,11 @@ def get_branch_name ():", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"178\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"179\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"180\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-r\" data-line=\"181\"><span class=\"d-s\">- </span><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line d-a\" data-line=\"181\"><span class=\"d-s\">+ </span><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parents&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"182\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"183\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"184\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line d-r\" data-line=\"185\"><span class=\"d-s\">- </span>    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line d-a\" data-line=\"185\"><span class=\"d-s\">+ </span>    <span class=\"n\">parents</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"186\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"187\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"188\"><span class=\"d-s\">  </span>    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span></code></pre></div>\n"}, {"title": "@@ -191,12 +191,12 @@ def get_commit (oid):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"191\"><span class=\"d-s\">  </span>        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"192\"><span class=\"d-s\">  </span>            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"193\"><span class=\"d-s\">  </span>        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"194\"><span class=\"d-s\">- </span>            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line d-a\" data-line=\"194\"><span class=\"d-s\">+ </span>            <span class=\"n\">parents</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"195\"><span class=\"d-s\">  </span>        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"196\"><span class=\"d-s\">  </span>            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"197\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"198\"><span class=\"d-s\">  </span>    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"199\"><span class=\"d-s\">- </span>    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"199\"><span class=\"d-s\">+ </span>    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parents</span><span class=\"o\">=</span><span class=\"n\">parents</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"200\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"201\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"202\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}, {"title": "@@ -211,8 +211,10 @@ def iter_commits_and_parents (oids):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"211\"><span class=\"d-s\">  </span>        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"212\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"213\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line d-r\" data-line=\"214\"><span class=\"d-s\">- </span>        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line d-r\" data-line=\"214\"><span class=\"d-s\">- </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"214\"><span class=\"d-s\">+ </span>        <span class=\"c1\"># Return first parent next</span>\n</span><span class=\"line d-a\" data-line=\"215\"><span class=\"d-s\">+ </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">extendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[:</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n</span><span class=\"line d-a\" data-line=\"216\"><span class=\"d-s\">+ </span>        <span class=\"c1\"># Return other parents later</span>\n</span><span class=\"line d-a\" data-line=\"217\"><span class=\"d-s\">+ </span>        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:])</span>\n</span><span class=\"line\" data-line=\"218\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"219\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"220\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span></code></pre></div>\n"}]}, "ugit/cli.py": {"changed_lines": [139, 140, 189, 190], "hunks": [{"title": "@@ -136,8 +136,8 @@ def show (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"136\"><span class=\"d-s\">  </span>        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"137\"><span class=\"d-s\">  </span>    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\"><span class=\"d-s\">  </span>    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line d-r\" data-line=\"139\"><span class=\"d-s\">- </span>    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"139\"><span class=\"d-s\">- </span>        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line d-a\" data-line=\"139\"><span class=\"d-s\">+ </span>    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"140\"><span class=\"d-s\">+ </span>        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"141\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"142\"><span class=\"d-s\">  </span>    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\"><span class=\"d-s\">  </span>    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span></code></pre></div>\n"}, {"title": "@@ -186,8 +186,8 @@ def k (args):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"186\"><span class=\"d-s\">  </span>    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"187\"><span class=\"d-s\">  </span>        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"188\"><span class=\"d-s\">  </span>        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-r\" data-line=\"189\"><span class=\"d-s\">- </span>        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line d-r\" data-line=\"189\"><span class=\"d-s\">- </span>            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line d-a\" data-line=\"189\"><span class=\"d-s\">+ </span>        <span class=\"k\">for</span> <span class=\"n\">parent</span> <span class=\"ow\">in</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">:</span>\n</span><span class=\"line d-a\" data-line=\"190\"><span class=\"d-s\">+ </span>            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"191\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"192\"><span class=\"d-s\">  </span>    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"193\"><span class=\"d-s\">  </span>    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "8be9ba7f315589e500465c498df0494e1068701c", "ugit/cli.py": "308b952153f72bf03791cb46defc600523a76f9b", "ugit/data.py": "2502091ade6455111cf02c310284202e239fdf5a", "ugit/diff.py": "e740248bc87e18bd244ca219330df3c4e7ac19cf"}}, {"oid": "a5846ccb5a8aab862b803aea69a635223a0af55b", "id": "delete-refs", "title": "data: Delete refs", "message": "<p>In preparations for the next change, let's create <code>data.delete_ref()</code> that removes an existing ref. It's not used at the moment but will be soon.</p>\n", "diff": {"ugit/data.py": {"changed_lines": [36, 37, 38, 39, 40], "hunks": [{"title": "@@ -33,6 +33,11 @@ def get_ref (ref, deref=True):", "diff": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"33\"><span class=\"d-s\">  </span>    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"34\"><span class=\"d-s\">  </span>\n</span><span class=\"line\" data-line=\"35\"><span class=\"d-s\">  </span>\n</span><span class=\"line d-a\" data-line=\"36\"><span class=\"d-s\">+ </span><span class=\"k\">def</span> <span class=\"nf\">delete_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line d-a\" data-line=\"37\"><span class=\"d-s\">+ </span>    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line d-a\" data-line=\"38\"><span class=\"d-s\">+ </span>    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line d-a\" data-line=\"39\"><span class=\"d-s\">+ </span>\n</span><span class=\"line d-a\" data-line=\"40\"><span class=\"d-s\">+ </span>\n</span><span class=\"line\" data-line=\"41\"><span class=\"d-s\">  </span><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"42\"><span class=\"d-s\">  </span>    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"43\"><span class=\"d-s\">  </span>    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span></code></pre></div>\n"}]}}, "tree": {".gitignore": "567994ceb193ad3c00ebec195c7a702c2223826e", "setup.py": "9c0db12ec5a6601de28ac37b24136054415e1d96", "ugit/base.py": "8be9ba7f315589e500465c498df0494e1068701c", "ugit/cli.py": "308b952153f72bf03791cb46defc600523a76f9b", "ugit/data.py": "9224a612af2fadd5414a530a02852e457af3ad61", "ugit/diff.py": "e740248bc87e18bd244ca219330df3c4e7ac19cf"}}], "objects": {"53104e26719d9af8897fc8704ce07dbf8a886281": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"66\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"68\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">        <span class=\"k\">for</span> <span class=\"n\">dirname</span> <span class=\"ow\">in</span> <span class=\"n\">dirnames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"71\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">dirname</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"73\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"74\">            <span class=\"k\">try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"75\">                <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">rmdir</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">            <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">,</span> <span class=\"ne\">OSError</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">                <span class=\"c1\"># Deletion might fail if the directory contains ignored files,</span>\n</span><span class=\"line\" data-line=\"78\">                <span class=\"c1\"># so it&#39;s OK</span>\n</span><span class=\"line\" data-line=\"79\">                <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"85\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"87\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"95\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"105\">\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"108\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"113\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"115\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">\n</span><span class=\"line\" data-line=\"128\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">\n</span><span class=\"line\" data-line=\"132\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"134\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">\n</span><span class=\"line\" data-line=\"137\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\">\n</span><span class=\"line\" data-line=\"150\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"157\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"159\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"160\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"161\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"162\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"163\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"165\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"168\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"172\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"nb\">set</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"176\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"177\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"178\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"180\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"181\">\n</span><span class=\"line\" data-line=\"182\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"183\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"184\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"185\">\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"188\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"189\">\n</span><span class=\"line\" data-line=\"190\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"191\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"192\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"193\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"194\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"195\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"196\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"197\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"198\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"199\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"200\">\n</span><span class=\"line\" data-line=\"201\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"202\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"204\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"205\">\n</span><span class=\"line\" data-line=\"206\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"207\">\n</span><span class=\"line\" data-line=\"208\">\n</span><span class=\"line\" data-line=\"209\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"210\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "b56613b28b022968fd912389e2d09f370034bc9a": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"21\">\n</span><span class=\"line\" data-line=\"22\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"78\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"79\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"84\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"89\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"101\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"110\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">        <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">[</span><span class=\"n\">oid</span><span class=\"p\">])</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"113\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"115\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">\n</span><span class=\"line\" data-line=\"122\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"129\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"130\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"131\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"132\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"133\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\">\n</span><span class=\"line\" data-line=\"137\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"143\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"145\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"146\">\n</span><span class=\"line\" data-line=\"147\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"151\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"157\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"158\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"159\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"163\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"165\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"166\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"167\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"168\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"172\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "c411e360d7a0d31009c130dcc75afb1bec7584de": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"21\">\n</span><span class=\"line\" data-line=\"22\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">\n</span><span class=\"line\" data-line=\"31\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">\n</span><span class=\"line\" data-line=\"46\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">\n</span><span class=\"line\" data-line=\"78\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"79\">\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"88\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"101\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"106\">\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"116\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"118\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"121\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"128\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">\n</span><span class=\"line\" data-line=\"132\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"142\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"143\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"144\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"145\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"147\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"148\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">\n</span><span class=\"line\" data-line=\"150\">\n</span><span class=\"line\" data-line=\"151\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"155\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"156\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"157\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"158\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"159\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"162\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"163\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"165\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"168\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">\n</span><span class=\"line\" data-line=\"170\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"171\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"172\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"173\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"178\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"179\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"180\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"181\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"182\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\">\n</span><span class=\"line\" data-line=\"185\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"186\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "5ecdcc7c76a7b692947c57b28381c81ea59e7f16": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"89\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"119\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"142\">\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"146\">\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"150\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"152\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"153\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"155\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"156\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"157\">\n</span><span class=\"line\" data-line=\"158\">\n</span><span class=\"line\" data-line=\"159\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"160\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"163\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"166\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"167\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"168\">\n</span><span class=\"line\" data-line=\"169\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"170\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"171\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"172\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"173\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"176\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"177\">\n</span><span class=\"line\" data-line=\"178\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"179\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"181\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"182\">\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"185\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"186\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"187\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"188\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"190\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"191\">\n</span><span class=\"line\" data-line=\"192\">\n</span><span class=\"line\" data-line=\"193\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"194\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "61028beb583bad641710179746339d97dbb51b7c": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line\" data-line=\"2\">\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"5\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span> <span class=\"p\">(</span><span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"6\">    <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">tree</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"7\">        <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"8\">            <span class=\"n\">entries</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oids</span> <span class=\"ow\">in</span> <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"11\">        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"15\">    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"16\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"18\">            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;changed: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n", "78335fe018b50119420baafcf1da50557afbcc2b": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">\n</span><span class=\"line\" data-line=\"72\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\">\n</span><span class=\"line\" data-line=\"82\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"89\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\">\n</span><span class=\"line\" data-line=\"92\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"93\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"94\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\">\n</span><span class=\"line\" data-line=\"97\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"111\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"113\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"114\">\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"119\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"122\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">\n</span><span class=\"line\" data-line=\"126\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"127\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"128\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"152\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"153\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"154\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"156\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"157\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"158\">\n</span><span class=\"line\" data-line=\"159\">\n</span><span class=\"line\" data-line=\"160\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"161\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"162\">\n</span><span class=\"line\" data-line=\"163\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"166\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"167\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"168\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">\n</span><span class=\"line\" data-line=\"170\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"171\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"172\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"173\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"174\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"178\">\n</span><span class=\"line\" data-line=\"179\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"181\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"182\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\">\n</span><span class=\"line\" data-line=\"185\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"186\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"187\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"188\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"189\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"190\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"191\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"192\">\n</span><span class=\"line\" data-line=\"193\">\n</span><span class=\"line\" data-line=\"194\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"195\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "8fe2131a4a01c92bee261ad1c82d93795ef42a03": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"2\">\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">tempfile</span> <span class=\"kn\">import</span> <span class=\"n\">NamedTemporaryFile</span> <span class=\"k\">as</span> <span class=\"n\">Temp</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span> <span class=\"p\">(</span><span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">tree</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">        <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">            <span class=\"n\">entries</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oids</span> <span class=\"ow\">in</span> <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\"><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"23\">            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"n\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"24\">    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\"><span class=\"k\">def</span> <span class=\"nf\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_from</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"29\">        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"p\">)):</span>\n</span><span class=\"line\" data-line=\"30\">            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"31\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"35\">            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--unified&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--show-c-function&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"36\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;a/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"37\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;b/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"38\">            <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"39\">            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n", "f3036e83f9ba1486a2f0cf941b7a89dd9eb39555": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">get_working_tree</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"66\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"69\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"70\">            <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"71\">                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"72\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"78\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"79\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"80\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"81\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">        <span class=\"k\">for</span> <span class=\"n\">dirname</span> <span class=\"ow\">in</span> <span class=\"n\">dirnames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"83\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">dirname</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"84\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"85\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"86\">            <span class=\"k\">try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"87\">                <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">rmdir</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"88\">            <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">,</span> <span class=\"ne\">OSError</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"89\">                <span class=\"c1\"># Deletion might fail if the directory contains ignored files,</span>\n</span><span class=\"line\" data-line=\"90\">                <span class=\"c1\"># so it&#39;s OK</span>\n</span><span class=\"line\" data-line=\"91\">                <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"99\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">\n</span><span class=\"line\" data-line=\"132\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"134\">\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"138\">\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"142\">\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"156\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"157\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"163\">\n</span><span class=\"line\" data-line=\"164\">\n</span><span class=\"line\" data-line=\"165\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"166\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"170\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"171\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"172\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"173\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"174\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"175\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"176\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"177\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"178\">\n</span><span class=\"line\" data-line=\"179\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"180\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"181\">\n</span><span class=\"line\" data-line=\"182\">\n</span><span class=\"line\" data-line=\"183\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"184\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"nb\">set</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"185\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"188\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"189\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"190\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"191\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"192\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"193\">\n</span><span class=\"line\" data-line=\"194\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"195\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"196\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"197\">\n</span><span class=\"line\" data-line=\"198\">\n</span><span class=\"line\" data-line=\"199\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"200\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"201\">\n</span><span class=\"line\" data-line=\"202\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"204\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"205\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"206\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"207\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"208\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"209\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"210\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"211\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"212\">\n</span><span class=\"line\" data-line=\"213\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"214\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"215\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"216\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"217\">\n</span><span class=\"line\" data-line=\"218\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"219\">\n</span><span class=\"line\" data-line=\"220\">\n</span><span class=\"line\" data-line=\"221\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"222\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "14f68302425652b40b27ee836357461763587767": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">diff_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">_diff</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"93\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"122\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"126\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">\n</span><span class=\"line\" data-line=\"130\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">_diff</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"162\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"163\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"165\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"166\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"167\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"168\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\">\n</span><span class=\"line\" data-line=\"172\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"176\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"178\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"181\">\n</span><span class=\"line\" data-line=\"182\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"183\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"184\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"185\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"186\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"187\">\n</span><span class=\"line\" data-line=\"188\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"190\">\n</span><span class=\"line\" data-line=\"191\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"192\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"193\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"194\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"195\">\n</span><span class=\"line\" data-line=\"196\">\n</span><span class=\"line\" data-line=\"197\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"198\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"199\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"200\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"201\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"202\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"203\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"204\">\n</span><span class=\"line\" data-line=\"205\">\n</span><span class=\"line\" data-line=\"206\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"207\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "df0fef94e58efd643a5575ad7a62d60cec7811e9": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">diff_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">_diff</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"84\">\n</span><span class=\"line\" data-line=\"85\">\n</span><span class=\"line\" data-line=\"86\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"87\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"88\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\">\n</span><span class=\"line\" data-line=\"91\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"93\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\">\n</span><span class=\"line\" data-line=\"96\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"98\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"116\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"117\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\">\n</span><span class=\"line\" data-line=\"120\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"122\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"123\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"126\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">\n</span><span class=\"line\" data-line=\"130\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"132\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"134\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"141\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">_diff</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"162\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"163\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"164\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"165\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"166\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"167\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"168\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"169\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\">\n</span><span class=\"line\" data-line=\"172\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"176\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"178\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"181\">\n</span><span class=\"line\" data-line=\"182\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"183\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"184\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"185\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"186\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"187\">\n</span><span class=\"line\" data-line=\"188\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"190\">\n</span><span class=\"line\" data-line=\"191\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"192\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"193\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"194\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"195\">\n</span><span class=\"line\" data-line=\"196\">\n</span><span class=\"line\" data-line=\"197\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"198\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"199\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"200\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"201\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"202\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"203\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"204\">\n</span><span class=\"line\" data-line=\"205\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Changes to be committed:</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"206\">    <span class=\"n\">HEAD_tree</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"207\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">HEAD_tree</span><span class=\"p\">),</span>\n</span><span class=\"line\" data-line=\"208\">                                                 <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">()):</span>\n</span><span class=\"line\" data-line=\"209\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">action</span><span class=\"si\">:</span><span class=\"s1\">&gt;12</span><span class=\"si\">}</span><span class=\"s1\">: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"210\">\n</span><span class=\"line\" data-line=\"211\">\n</span><span class=\"line\" data-line=\"212\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"213\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "56ffdf9e989059eba532f997dfff4720b8c994c4": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"2\">\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">tempfile</span> <span class=\"kn\">import</span> <span class=\"n\">NamedTemporaryFile</span> <span class=\"k\">as</span> <span class=\"n\">Temp</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span> <span class=\"p\">(</span><span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">tree</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">        <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">            <span class=\"n\">entries</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oids</span> <span class=\"ow\">in</span> <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\"><span class=\"k\">def</span> <span class=\"nf\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"21\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">            <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;new file&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_from</span> <span class=\"k\">else</span>\n</span><span class=\"line\" data-line=\"23\">                      <span class=\"s1\">&#39;deleted&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_to</span> <span class=\"k\">else</span>\n</span><span class=\"line\" data-line=\"24\">                      <span class=\"s1\">&#39;modified&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">            <span class=\"k\">yield</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span>\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\"><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"32\">            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"n\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\"><span class=\"k\">def</span> <span class=\"nf\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_from</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"38\">        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"p\">)):</span>\n</span><span class=\"line\" data-line=\"39\">            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"40\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"41\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"44\">            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--unified&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--show-c-function&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"45\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;a/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"46\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;b/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"47\">            <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"48\">            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"49\">\n</span><span class=\"line\" data-line=\"50\">        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n", "a329d38660916137f6d32ef3becc2dfb31205c55": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\">\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"12\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"17\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"19\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"22\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"23\">\n</span><span class=\"line\" data-line=\"24\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"25\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"27\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"28\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"32\">\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"34\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"36\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"41\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"44\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"55\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"57\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"58\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"59\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"61\">\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\"><span class=\"k\">def</span> <span class=\"nf\">get_working_tree</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"66\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"67\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"68\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"69\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"70\">            <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"71\">                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"72\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"76\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"77\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"78\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"79\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"80\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"81\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">        <span class=\"k\">for</span> <span class=\"n\">dirname</span> <span class=\"ow\">in</span> <span class=\"n\">dirnames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"83\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">dirname</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"84\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"85\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"86\">            <span class=\"k\">try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"87\">                <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">rmdir</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"88\">            <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">,</span> <span class=\"ne\">OSError</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"89\">                <span class=\"c1\"># Deletion might fail if the directory contains ignored files,</span>\n</span><span class=\"line\" data-line=\"90\">                <span class=\"c1\"># so it&#39;s OK</span>\n</span><span class=\"line\" data-line=\"91\">                <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"92\">\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"95\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"98\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"99\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"100\">\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"103\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\">\n</span><span class=\"line\" data-line=\"119\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"120\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">\n</span><span class=\"line\" data-line=\"131\">\n</span><span class=\"line\" data-line=\"132\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"133\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"134\">\n</span><span class=\"line\" data-line=\"135\">\n</span><span class=\"line\" data-line=\"136\"><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"c1\"># TODO merge HEAD into other</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"151\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"152\">\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"155\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\">\n</span><span class=\"line\" data-line=\"158\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"159\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"160\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"161\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"162\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"163\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"165\">\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"168\">\n</span><span class=\"line\" data-line=\"169\">\n</span><span class=\"line\" data-line=\"170\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"171\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"172\">\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"174\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"175\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"176\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"177\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"178\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"179\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"180\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"181\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"182\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"185\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">\n</span><span class=\"line\" data-line=\"188\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"nb\">set</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"190\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"191\">\n</span><span class=\"line\" data-line=\"192\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"193\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"194\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"195\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"196\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"197\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"198\">\n</span><span class=\"line\" data-line=\"199\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"200\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"201\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"202\">\n</span><span class=\"line\" data-line=\"203\">\n</span><span class=\"line\" data-line=\"204\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"205\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"206\">\n</span><span class=\"line\" data-line=\"207\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"208\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"209\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"210\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"211\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"212\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"213\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"214\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"215\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"216\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"217\">\n</span><span class=\"line\" data-line=\"218\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"219\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"220\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"221\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"222\">\n</span><span class=\"line\" data-line=\"223\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"224\">\n</span><span class=\"line\" data-line=\"225\">\n</span><span class=\"line\" data-line=\"226\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"227\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "60b4ee0ce265702b84e5bd969dbc8d6314fc6c5a": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">diff_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">_diff</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">merge_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;merge&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">merge</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"101\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"120\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\"><span class=\"k\">def</span> <span class=\"nf\">_diff</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"162\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"163\">\n</span><span class=\"line\" data-line=\"164\">\n</span><span class=\"line\" data-line=\"165\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"166\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"167\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"168\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"169\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"170\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"171\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"172\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"173\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"178\">\n</span><span class=\"line\" data-line=\"179\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"180\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"181\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"182\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"183\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"184\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"185\">\n</span><span class=\"line\" data-line=\"186\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"187\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"188\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"189\">        <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"190\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"191\">\n</span><span class=\"line\" data-line=\"192\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"193\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"194\">\n</span><span class=\"line\" data-line=\"195\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"196\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"197\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"198\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"199\">\n</span><span class=\"line\" data-line=\"200\">\n</span><span class=\"line\" data-line=\"201\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"202\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"204\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"205\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"206\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"207\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"208\">\n</span><span class=\"line\" data-line=\"209\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Changes to be committed:</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"210\">    <span class=\"n\">HEAD_tree</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"211\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">HEAD_tree</span><span class=\"p\">),</span>\n</span><span class=\"line\" data-line=\"212\">                                                 <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">()):</span>\n</span><span class=\"line\" data-line=\"213\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">action</span><span class=\"si\">:</span><span class=\"s1\">&gt;12</span><span class=\"si\">}</span><span class=\"s1\">: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"214\">\n</span><span class=\"line\" data-line=\"215\">\n</span><span class=\"line\" data-line=\"216\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"217\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"218\">\n</span><span class=\"line\" data-line=\"219\">\n</span><span class=\"line\" data-line=\"220\"><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"221\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "0639a0df99b6524dd11c289cdc9cc40c77ff7418": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"22\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"23\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"27\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"28\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"29\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"31\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"36\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">\n</span><span class=\"line\" data-line=\"40\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"42\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"55\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"56\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"57\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"58\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"59\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"60\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\"><span class=\"k\">def</span> <span class=\"nf\">get_working_tree</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"67\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"68\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"71\">            <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"78\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"79\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"81\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"82\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"83\">        <span class=\"k\">for</span> <span class=\"n\">dirname</span> <span class=\"ow\">in</span> <span class=\"n\">dirnames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"84\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">dirname</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"86\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"87\">            <span class=\"k\">try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"88\">                <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">rmdir</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">            <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">,</span> <span class=\"ne\">OSError</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"90\">                <span class=\"c1\"># Deletion might fail if the directory contains ignored files,</span>\n</span><span class=\"line\" data-line=\"91\">                <span class=\"c1\"># so it&#39;s OK</span>\n</span><span class=\"line\" data-line=\"92\">                <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"98\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"100\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\"><span class=\"k\">def</span> <span class=\"nf\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"104\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">blob</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">merge_trees</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">),</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_other</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"106\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;./</span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"108\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">blob</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"116\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">\n</span><span class=\"line\" data-line=\"128\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"134\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span>\n</span><span class=\"line\" data-line=\"148\">    <span class=\"n\">c_HEAD</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"n\">c_other</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"150\">\n</span><span class=\"line\" data-line=\"151\">    <span class=\"n\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">c_HEAD</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">c_other</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Merged in working tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\">\n</span><span class=\"line\" data-line=\"155\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"156\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"157\">\n</span><span class=\"line\" data-line=\"158\">\n</span><span class=\"line\" data-line=\"159\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"160\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">\n</span><span class=\"line\" data-line=\"163\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\">\n</span><span class=\"line\" data-line=\"172\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"174\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"175\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"176\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"178\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"179\">\n</span><span class=\"line\" data-line=\"180\">\n</span><span class=\"line\" data-line=\"181\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"182\">\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"185\">    <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"188\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"190\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"191\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"192\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"193\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"194\">            <span class=\"n\">parent</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"195\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"196\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"197\">\n</span><span class=\"line\" data-line=\"198\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"199\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parent</span><span class=\"o\">=</span><span class=\"n\">parent</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"200\">\n</span><span class=\"line\" data-line=\"201\">\n</span><span class=\"line\" data-line=\"202\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"nb\">set</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"204\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"205\">\n</span><span class=\"line\" data-line=\"206\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"207\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"208\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"209\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"210\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"211\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"212\">\n</span><span class=\"line\" data-line=\"213\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"214\">        <span class=\"c1\"># Return parent next</span>\n</span><span class=\"line\" data-line=\"215\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">appendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parent</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"216\">\n</span><span class=\"line\" data-line=\"217\">\n</span><span class=\"line\" data-line=\"218\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"219\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"220\">\n</span><span class=\"line\" data-line=\"221\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"222\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"223\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"224\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"225\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"226\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"227\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"228\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"229\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"230\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"231\">\n</span><span class=\"line\" data-line=\"232\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"233\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"234\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"235\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"236\">\n</span><span class=\"line\" data-line=\"237\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"238\">\n</span><span class=\"line\" data-line=\"239\">\n</span><span class=\"line\" data-line=\"240\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"241\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "e740248bc87e18bd244ca219330df3c4e7ac19cf": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"2\">\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">defaultdict</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">tempfile</span> <span class=\"kn\">import</span> <span class=\"n\">NamedTemporaryFile</span> <span class=\"k\">as</span> <span class=\"n\">Temp</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">compare_trees</span> <span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"n\">defaultdict</span> <span class=\"p\">(</span><span class=\"k\">lambda</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">tree</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span> <span class=\"p\">(</span><span class=\"n\">trees</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"12\">        <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">            <span class=\"n\">entries</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"14\">\n</span><span class=\"line\" data-line=\"15\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oids</span> <span class=\"ow\">in</span> <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"16\">        <span class=\"k\">yield</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">oids</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"17\">\n</span><span class=\"line\" data-line=\"18\">\n</span><span class=\"line\" data-line=\"19\"><span class=\"k\">def</span> <span class=\"nf\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"20\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"21\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">            <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s1\">&#39;new file&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_from</span> <span class=\"k\">else</span>\n</span><span class=\"line\" data-line=\"23\">                      <span class=\"s1\">&#39;deleted&#39;</span> <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">o_to</span> <span class=\"k\">else</span>\n</span><span class=\"line\" data-line=\"24\">                      <span class=\"s1\">&#39;modified&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"25\">            <span class=\"k\">yield</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span>\n</span><span class=\"line\" data-line=\"26\">\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\"><span class=\"k\">def</span> <span class=\"nf\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">output</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_from</span><span class=\"p\">,</span> <span class=\"n\">t_to</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"31\">        <span class=\"k\">if</span> <span class=\"n\">o_from</span> <span class=\"o\">!=</span> <span class=\"n\">o_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"32\">            <span class=\"n\">output</span> <span class=\"o\">+=</span> <span class=\"n\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\"><span class=\"k\">def</span> <span class=\"nf\">diff_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_from</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_to</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"38\">        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_from</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_to</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"p\">)):</span>\n</span><span class=\"line\" data-line=\"39\">            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"40\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"41\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"44\">            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--unified&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--show-c-function&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"45\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;a/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_from</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"46\">             <span class=\"s1\">&#39;--label&#39;</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;b/</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_to</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"47\">            <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"48\">            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"49\">\n</span><span class=\"line\" data-line=\"50\">        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span><span class=\"line\" data-line=\"51\">\n</span><span class=\"line\" data-line=\"52\">\n</span><span class=\"line\" data-line=\"53\"><span class=\"k\">def</span> <span class=\"nf\">merge_trees</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"54\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"55\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span> <span class=\"ow\">in</span> <span class=\"n\">compare_trees</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"56\">        <span class=\"n\">tree</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">merge_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"k\">return</span> <span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">\n</span><span class=\"line\" data-line=\"60\"><span class=\"k\">def</span> <span class=\"nf\">merge_blobs</span> <span class=\"p\">(</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">o_other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"k\">with</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_HEAD</span><span class=\"p\">,</span> <span class=\"n\">Temp</span> <span class=\"p\">()</span> <span class=\"k\">as</span> <span class=\"n\">f_other</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"62\">        <span class=\"k\">for</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"p\">((</span><span class=\"n\">o_HEAD</span><span class=\"p\">,</span> <span class=\"n\">f_HEAD</span><span class=\"p\">),</span> <span class=\"p\">(</span><span class=\"n\">o_other</span><span class=\"p\">,</span> <span class=\"n\">f_other</span><span class=\"p\">)):</span>\n</span><span class=\"line\" data-line=\"63\">            <span class=\"k\">if</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"64\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"65\">                <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"66\">\n</span><span class=\"line\" data-line=\"67\">        <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"68\">            <span class=\"p\">[</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"69\">             <span class=\"s1\">&#39;-DHEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">f_HEAD</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"70\">             <span class=\"n\">f_other</span><span class=\"o\">.</span><span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"71\">            <span class=\"p\">],</span> <span class=\"n\">stdout</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">            <span class=\"n\">output</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"73\">\n</span><span class=\"line\" data-line=\"74\">        <span class=\"k\">return</span> <span class=\"n\">output</span>\n</span></code></pre></div>\n", "8be9ba7f315589e500465c498df0494e1068701c": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">itertools</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">operator</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">string</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">deque</span><span class=\"p\">,</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s1\">&#39;refs/heads/master&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"o\">=</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">entries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"19\">    <span class=\"k\">with</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">scandir</span> <span class=\"p\">(</span><span class=\"n\">directory</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"20\">        <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">it</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"21\">            <span class=\"n\">full</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">directory</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"22\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"23\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">            <span class=\"k\">if</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_file</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"26\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;blob&#39;</span>\n</span><span class=\"line\" data-line=\"27\">                <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"28\">                    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"29\">            <span class=\"k\">elif</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">is_dir</span> <span class=\"p\">(</span><span class=\"n\">follow_symlinks</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"30\">                <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;tree&#39;</span>\n</span><span class=\"line\" data-line=\"31\">                <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">full</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"32\">            <span class=\"n\">entries</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">((</span><span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"33\">\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"35\">                    <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">type_</span>\n</span><span class=\"line\" data-line=\"36\">                    <span class=\"ow\">in</span> <span class=\"nb\">sorted</span> <span class=\"p\">(</span><span class=\"n\">entries</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">\n</span><span class=\"line\" data-line=\"40\"><span class=\"k\">def</span> <span class=\"nf\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"42\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">for</span> <span class=\"n\">entry</span> <span class=\"ow\">in</span> <span class=\"n\">tree</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">entry</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">        <span class=\"k\">yield</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\">\n</span><span class=\"line\" data-line=\"49\"><span class=\"k\">def</span> <span class=\"nf\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"50\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"51\">    <span class=\"k\">for</span> <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">_iter_tree_entries</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"52\">        <span class=\"k\">assert</span> <span class=\"s1\">&#39;/&#39;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"53\">        <span class=\"k\">assert</span> <span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"s1\">&#39;..&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;.&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">        <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">base_path</span> <span class=\"o\">+</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"55\">        <span class=\"k\">if</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"56\">            <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"57\">        <span class=\"k\">elif</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"58\">            <span class=\"n\">result</span><span class=\"o\">.</span><span class=\"n\">update</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">/&#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"59\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"60\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown tree entry </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">\n</span><span class=\"line\" data-line=\"64\"><span class=\"k\">def</span> <span class=\"nf\">get_working_tree</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"67\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"68\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"71\">            <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"72\">                <span class=\"n\">result</span><span class=\"p\">[</span><span class=\"n\">path</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"73\">    <span class=\"k\">return</span> <span class=\"n\">result</span>\n</span><span class=\"line\" data-line=\"74\">\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\"><span class=\"k\">def</span> <span class=\"nf\">_empty_current_directory</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">dirnames</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"s1\">&#39;.&#39;</span><span class=\"p\">,</span> <span class=\"n\">topdown</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"78\">        <span class=\"k\">for</span> <span class=\"n\">filename</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"79\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">filename</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"81\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"82\">            <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"83\">        <span class=\"k\">for</span> <span class=\"n\">dirname</span> <span class=\"ow\">in</span> <span class=\"n\">dirnames</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"84\">            <span class=\"n\">path</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">dirname</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">            <span class=\"k\">if</span> <span class=\"n\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"86\">                <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"87\">            <span class=\"k\">try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"88\">                <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">rmdir</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"89\">            <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"ne\">FileNotFoundError</span><span class=\"p\">,</span> <span class=\"ne\">OSError</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"90\">                <span class=\"c1\"># Deletion might fail if the directory contains ignored files,</span>\n</span><span class=\"line\" data-line=\"91\">                <span class=\"c1\"># so it&#39;s OK</span>\n</span><span class=\"line\" data-line=\"92\">                <span class=\"k\">pass</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"97\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree_oid</span><span class=\"p\">,</span> <span class=\"n\">base_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;./&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"98\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"99\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"100\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"101\">\n</span><span class=\"line\" data-line=\"102\">\n</span><span class=\"line\" data-line=\"103\"><span class=\"k\">def</span> <span class=\"nf\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">,</span> <span class=\"n\">t_other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"104\">    <span class=\"n\">_empty_current_directory</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"105\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">blob</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">merge_trees</span> <span class=\"p\">(</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_HEAD</span><span class=\"p\">),</span> <span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">t_other</span><span class=\"p\">))</span><span class=\"o\">.</span><span class=\"n\">items</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"106\">        <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;./</span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"107\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"108\">            <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">blob</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"109\">\n</span><span class=\"line\" data-line=\"110\">\n</span><span class=\"line\" data-line=\"111\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">message</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"112\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;tree </span><span class=\"si\">{</span><span class=\"n\">write_tree</span> <span class=\"p\">()</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"113\">\n</span><span class=\"line\" data-line=\"114\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"115\">    <span class=\"k\">if</span> <span class=\"n\">HEAD</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"116\">        <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;parent </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"117\">\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"n\">commit</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">message</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"120\">\n</span><span class=\"line\" data-line=\"121\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">(),</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"124\">\n</span><span class=\"line\" data-line=\"125\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"126\">\n</span><span class=\"line\" data-line=\"127\">\n</span><span class=\"line\" data-line=\"128\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"129\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"130\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"131\">    <span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">    <span class=\"k\">if</span> <span class=\"n\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"134\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"137\">\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"139\">\n</span><span class=\"line\" data-line=\"140\">\n</span><span class=\"line\" data-line=\"141\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"143\">\n</span><span class=\"line\" data-line=\"144\">\n</span><span class=\"line\" data-line=\"145\"><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"147\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span>\n</span><span class=\"line\" data-line=\"148\">    <span class=\"n\">c_HEAD</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"149\">    <span class=\"n\">c_other</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">other</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"150\">\n</span><span class=\"line\" data-line=\"151\">    <span class=\"n\">read_tree_merged</span> <span class=\"p\">(</span><span class=\"n\">c_HEAD</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">c_other</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"152\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Merged in working tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"153\">\n</span><span class=\"line\" data-line=\"154\">\n</span><span class=\"line\" data-line=\"155\"><span class=\"k\">def</span> <span class=\"nf\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"156\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"157\">\n</span><span class=\"line\" data-line=\"158\">\n</span><span class=\"line\" data-line=\"159\"><span class=\"k\">def</span> <span class=\"nf\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"160\">    <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"161\">\n</span><span class=\"line\" data-line=\"162\">\n</span><span class=\"line\" data-line=\"163\"><span class=\"k\">def</span> <span class=\"nf\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"164\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"165\">        <span class=\"k\">yield</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"166\">\n</span><span class=\"line\" data-line=\"167\">\n</span><span class=\"line\" data-line=\"168\"><span class=\"k\">def</span> <span class=\"nf\">is_branch</span> <span class=\"p\">(</span><span class=\"n\">branch</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"169\">    <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"170\">\n</span><span class=\"line\" data-line=\"171\">\n</span><span class=\"line\" data-line=\"172\"><span class=\"k\">def</span> <span class=\"nf\">get_branch_name</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"173\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"174\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"175\">        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"176\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"k\">assert</span> <span class=\"n\">HEAD</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;refs/heads/&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"178\">    <span class=\"k\">return</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">,</span> <span class=\"s1\">&#39;refs/heads&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"179\">\n</span><span class=\"line\" data-line=\"180\">\n</span><span class=\"line\" data-line=\"181\"><span class=\"n\">Commit</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;Commit&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;parents&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;message&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"182\">\n</span><span class=\"line\" data-line=\"183\">\n</span><span class=\"line\" data-line=\"184\"><span class=\"k\">def</span> <span class=\"nf\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"185\">    <span class=\"n\">parents</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n</span><span class=\"line\" data-line=\"186\">\n</span><span class=\"line\" data-line=\"187\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"188\">    <span class=\"n\">lines</span> <span class=\"o\">=</span> <span class=\"nb\">iter</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">splitlines</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"189\">    <span class=\"k\">for</span> <span class=\"n\">line</span> <span class=\"ow\">in</span> <span class=\"n\">itertools</span><span class=\"o\">.</span><span class=\"n\">takewhile</span> <span class=\"p\">(</span><span class=\"n\">operator</span><span class=\"o\">.</span><span class=\"n\">truth</span><span class=\"p\">,</span> <span class=\"n\">lines</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"190\">        <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">line</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39; &#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"191\">        <span class=\"k\">if</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"192\">            <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"193\">        <span class=\"k\">elif</span> <span class=\"n\">key</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;parent&#39;</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"194\">            <span class=\"n\">parents</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"195\">        <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"196\">            <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown field </span><span class=\"si\">{</span><span class=\"n\">key</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"197\">\n</span><span class=\"line\" data-line=\"198\">    <span class=\"n\">message</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">lines</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"199\">    <span class=\"k\">return</span> <span class=\"n\">Commit</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"o\">=</span><span class=\"n\">tree</span><span class=\"p\">,</span> <span class=\"n\">parents</span><span class=\"o\">=</span><span class=\"n\">parents</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"200\">\n</span><span class=\"line\" data-line=\"201\">\n</span><span class=\"line\" data-line=\"202\"><span class=\"k\">def</span> <span class=\"nf\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"n\">deque</span> <span class=\"p\">(</span><span class=\"nb\">set</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"204\">    <span class=\"n\">visited</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"205\">\n</span><span class=\"line\" data-line=\"206\">    <span class=\"k\">while</span> <span class=\"n\">oids</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"207\">        <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">popleft</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"208\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">oid</span> <span class=\"ow\">or</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">visited</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"209\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"210\">        <span class=\"n\">visited</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"211\">        <span class=\"k\">yield</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"212\">\n</span><span class=\"line\" data-line=\"213\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"214\">        <span class=\"c1\"># Return first parent next</span>\n</span><span class=\"line\" data-line=\"215\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">extendleft</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[:</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"216\">        <span class=\"c1\"># Return other parents later</span>\n</span><span class=\"line\" data-line=\"217\">        <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">:])</span>\n</span><span class=\"line\" data-line=\"218\">\n</span><span class=\"line\" data-line=\"219\">\n</span><span class=\"line\" data-line=\"220\"><span class=\"k\">def</span> <span class=\"nf\">get_oid</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"221\">    <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"o\">==</span> <span class=\"s1\">&#39;@&#39;</span><span class=\"p\">:</span> <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;HEAD&#39;</span>\n</span><span class=\"line\" data-line=\"222\">\n</span><span class=\"line\" data-line=\"223\">    <span class=\"c1\"># Name is ref</span>\n</span><span class=\"line\" data-line=\"224\">    <span class=\"n\">refs_to_try</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n</span><span class=\"line\" data-line=\"225\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"226\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"227\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/tags/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"228\">        <span class=\"sa\">f</span><span class=\"s1\">&#39;refs/heads/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span>\n</span><span class=\"line\" data-line=\"229\">    <span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"230\">    <span class=\"k\">for</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">refs_to_try</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"231\">        <span class=\"k\">if</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"232\">            <span class=\"k\">return</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"233\">\n</span><span class=\"line\" data-line=\"234\">    <span class=\"c1\"># Name is SHA1</span>\n</span><span class=\"line\" data-line=\"235\">    <span class=\"n\">is_hex</span> <span class=\"o\">=</span> <span class=\"nb\">all</span> <span class=\"p\">(</span><span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">string</span><span class=\"o\">.</span><span class=\"n\">hexdigits</span> <span class=\"k\">for</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"236\">    <span class=\"k\">if</span> <span class=\"nb\">len</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">40</span> <span class=\"ow\">and</span> <span class=\"n\">is_hex</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"237\">        <span class=\"k\">return</span> <span class=\"n\">name</span>\n</span><span class=\"line\" data-line=\"238\">\n</span><span class=\"line\" data-line=\"239\">    <span class=\"k\">assert</span> <span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Unknown name </span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"240\">\n</span><span class=\"line\" data-line=\"241\">\n</span><span class=\"line\" data-line=\"242\"><span class=\"k\">def</span> <span class=\"nf\">is_ignored</span> <span class=\"p\">(</span><span class=\"n\">path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"243\">    <span class=\"k\">return</span> <span class=\"s1\">&#39;.ugit&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;/&#39;</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "308b952153f72bf03791cb46defc600523a76f9b": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">argparse</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\"><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span>\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">import</span> <span class=\"nn\">sys</span>\n</span><span class=\"line\" data-line=\"5\"><span class=\"kn\">import</span> <span class=\"nn\">textwrap</span>\n</span><span class=\"line\" data-line=\"6\">\n</span><span class=\"line\" data-line=\"7\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">base</span>\n</span><span class=\"line\" data-line=\"8\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"9\"><span class=\"kn\">from</span> <span class=\"nn\">.</span> <span class=\"kn\">import</span> <span class=\"n\">diff</span>\n</span><span class=\"line\" data-line=\"10\">\n</span><span class=\"line\" data-line=\"11\">\n</span><span class=\"line\" data-line=\"12\"><span class=\"k\">def</span> <span class=\"nf\">main</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"13\">    <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"14\">    <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">func</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">parse_args</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">parser</span> <span class=\"o\">=</span> <span class=\"n\">argparse</span><span class=\"o\">.</span><span class=\"n\">ArgumentParser</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"n\">commands</span> <span class=\"o\">=</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">add_subparsers</span> <span class=\"p\">(</span><span class=\"n\">dest</span><span class=\"o\">=</span><span class=\"s1\">&#39;command&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">required</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n</span><span class=\"line\" data-line=\"22\">\n</span><span class=\"line\" data-line=\"23\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span>\n</span><span class=\"line\" data-line=\"24\">\n</span><span class=\"line\" data-line=\"25\">    <span class=\"n\">init_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;init&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">init_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">init</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"27\">\n</span><span class=\"line\" data-line=\"28\">    <span class=\"n\">hash_object_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;hash-object&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"29\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">hash_object</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">    <span class=\"n\">hash_object_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\">    <span class=\"n\">cat_file_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;cat-file&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">cat_file</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"34\">    <span class=\"n\">cat_file_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;object&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\">    <span class=\"n\">write_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;write-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">write_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">write_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"38\">\n</span><span class=\"line\" data-line=\"39\">    <span class=\"n\">read_tree_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;read-tree&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"40\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">read_tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"41\">    <span class=\"n\">read_tree_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tree&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"42\">\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">commit_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"45\">    <span class=\"n\">commit_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;-m&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;--message&#39;</span><span class=\"p\">,</span> <span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"46\">\n</span><span class=\"line\" data-line=\"47\">    <span class=\"n\">log_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;log&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">log</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"n\">log_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"50\">\n</span><span class=\"line\" data-line=\"51\">    <span class=\"n\">show_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;show&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"52\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">show</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">    <span class=\"n\">show_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"54\">\n</span><span class=\"line\" data-line=\"55\">    <span class=\"n\">diff_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;diff&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"56\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">_diff</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"57\">    <span class=\"n\">diff_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"58\">\n</span><span class=\"line\" data-line=\"59\">    <span class=\"n\">checkout_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;checkout&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"60\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">checkout</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">    <span class=\"n\">checkout_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"n\">tag_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;tag&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"64\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">tag</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"65\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"66\">    <span class=\"n\">tag_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;oid&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">    <span class=\"n\">branch_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;branch&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"69\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">branch</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;name&#39;</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">branch_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;start_point&#39;</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">nargs</span><span class=\"o\">=</span><span class=\"s1\">&#39;?&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"72\">\n</span><span class=\"line\" data-line=\"73\">    <span class=\"n\">k_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;k&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"n\">k_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">k</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">    <span class=\"n\">status_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;status&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"77\">    <span class=\"n\">status_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">status</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"78\">\n</span><span class=\"line\" data-line=\"79\">    <span class=\"n\">reset_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;reset&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"80\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">reset</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">reset_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">\n</span><span class=\"line\" data-line=\"83\">    <span class=\"n\">merge_parser</span> <span class=\"o\">=</span> <span class=\"n\">commands</span><span class=\"o\">.</span><span class=\"n\">add_parser</span> <span class=\"p\">(</span><span class=\"s1\">&#39;merge&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"84\">    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">set_defaults</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"o\">=</span><span class=\"n\">merge</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"85\">    <span class=\"n\">merge_parser</span><span class=\"o\">.</span><span class=\"n\">add_argument</span> <span class=\"p\">(</span><span class=\"s1\">&#39;commit&#39;</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"o\">=</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"86\">\n</span><span class=\"line\" data-line=\"87\">    <span class=\"k\">return</span> <span class=\"n\">parser</span><span class=\"o\">.</span><span class=\"n\">parse_args</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"88\">\n</span><span class=\"line\" data-line=\"89\">\n</span><span class=\"line\" data-line=\"90\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"91\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">init</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"92\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Initialized empty ugit repository in </span><span class=\"si\">{</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">getcwd</span><span class=\"p\">()</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"93\">\n</span><span class=\"line\" data-line=\"94\">\n</span><span class=\"line\" data-line=\"95\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"96\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">file</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"97\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()))</span>\n</span><span class=\"line\" data-line=\"98\">\n</span><span class=\"line\" data-line=\"99\">\n</span><span class=\"line\" data-line=\"100\"><span class=\"k\">def</span> <span class=\"nf\">cat_file</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"101\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"102\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">get_object</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">object</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"103\">\n</span><span class=\"line\" data-line=\"104\">\n</span><span class=\"line\" data-line=\"105\"><span class=\"k\">def</span> <span class=\"nf\">write_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"106\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">write_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"107\">\n</span><span class=\"line\" data-line=\"108\">\n</span><span class=\"line\" data-line=\"109\"><span class=\"k\">def</span> <span class=\"nf\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"110\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">read_tree</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"111\">\n</span><span class=\"line\" data-line=\"112\">\n</span><span class=\"line\" data-line=\"113\"><span class=\"k\">def</span> <span class=\"nf\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"114\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"115\">\n</span><span class=\"line\" data-line=\"116\">\n</span><span class=\"line\" data-line=\"117\"><span class=\"k\">def</span> <span class=\"nf\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"118\">    <span class=\"n\">refs_str</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39; (</span><span class=\"si\">{</span><span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span> <span class=\"p\">(</span><span class=\"n\">refs</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s1\">)&#39;</span> <span class=\"k\">if</span> <span class=\"n\">refs</span> <span class=\"k\">else</span> <span class=\"s1\">&#39;&#39;</span>\n</span><span class=\"line\" data-line=\"119\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;commit </span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}{</span><span class=\"n\">refs_str</span><span class=\"si\">}</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"120\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">textwrap</span><span class=\"o\">.</span><span class=\"n\">indent</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"s1\">&#39;    &#39;</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"121\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"122\">\n</span><span class=\"line\" data-line=\"123\">\n</span><span class=\"line\" data-line=\"124\"><span class=\"k\">def</span> <span class=\"nf\">log</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"125\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n</span><span class=\"line\" data-line=\"126\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"127\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"p\">[])</span><span class=\"o\">.</span><span class=\"n\">append</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"128\">\n</span><span class=\"line\" data-line=\"129\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">({</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">}):</span>\n</span><span class=\"line\" data-line=\"130\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"131\">        <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">,</span> <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">get</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"132\">\n</span><span class=\"line\" data-line=\"133\">\n</span><span class=\"line\" data-line=\"134\"><span class=\"k\">def</span> <span class=\"nf\">show</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"135\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"136\">        <span class=\"k\">return</span>\n</span><span class=\"line\" data-line=\"137\">    <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"138\">    <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"139\">    <span class=\"k\">if</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"140\">        <span class=\"n\">parent_tree</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"141\">\n</span><span class=\"line\" data-line=\"142\">    <span class=\"n\">_print_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"143\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"144\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">parent_tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">tree</span><span class=\"p\">))</span>\n</span><span class=\"line\" data-line=\"145\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"146\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"147\">\n</span><span class=\"line\" data-line=\"148\">\n</span><span class=\"line\" data-line=\"149\"><span class=\"k\">def</span> <span class=\"nf\">_diff</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"150\">    <span class=\"n\">tree</span> <span class=\"o\">=</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"151\">\n</span><span class=\"line\" data-line=\"152\">    <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">diff_trees</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">tree</span><span class=\"p\">),</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"153\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">flush</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"154\">    <span class=\"n\">sys</span><span class=\"o\">.</span><span class=\"n\">stdout</span><span class=\"o\">.</span><span class=\"n\">buffer</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">result</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"155\">\n</span><span class=\"line\" data-line=\"156\">\n</span><span class=\"line\" data-line=\"157\"><span class=\"k\">def</span> <span class=\"nf\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"158\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">checkout</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"159\">\n</span><span class=\"line\" data-line=\"160\">\n</span><span class=\"line\" data-line=\"161\"><span class=\"k\">def</span> <span class=\"nf\">tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"162\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_tag</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"163\">\n</span><span class=\"line\" data-line=\"164\">\n</span><span class=\"line\" data-line=\"165\"><span class=\"k\">def</span> <span class=\"nf\">branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"166\">    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"167\">        <span class=\"n\">current</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"168\">        <span class=\"k\">for</span> <span class=\"n\">branch</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_branch_names</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"169\">            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;*&#39;</span> <span class=\"k\">if</span> <span class=\"n\">branch</span> <span class=\"o\">==</span> <span class=\"n\">current</span> <span class=\"k\">else</span> <span class=\"s1\">&#39; &#39;</span>\n</span><span class=\"line\" data-line=\"170\">            <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">prefix</span><span class=\"si\">}</span><span class=\"s1\"> </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"171\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"172\">        <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">create_branch</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"173\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;Branch </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\"> created at </span><span class=\"si\">{</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">start_point</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"174\">\n</span><span class=\"line\" data-line=\"175\">\n</span><span class=\"line\" data-line=\"176\"><span class=\"k\">def</span> <span class=\"nf\">k</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"177\">    <span class=\"n\">dot</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;digraph commits {</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"178\">\n</span><span class=\"line\" data-line=\"179\">    <span class=\"n\">oids</span> <span class=\"o\">=</span> <span class=\"nb\">set</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"180\">    <span class=\"k\">for</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">ref</span> <span class=\"ow\">in</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"181\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=note]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"182\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">refname</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"183\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"184\">            <span class=\"n\">oids</span><span class=\"o\">.</span><span class=\"n\">add</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"185\">\n</span><span class=\"line\" data-line=\"186\">    <span class=\"k\">for</span> <span class=\"n\">oid</span> <span class=\"ow\">in</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">iter_commits_and_parents</span> <span class=\"p\">(</span><span class=\"n\">oids</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"187\">        <span class=\"n\">commit</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"188\">        <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; [shape=box style=filled label=&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&quot;]</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"189\">        <span class=\"k\">for</span> <span class=\"n\">parent</span> <span class=\"ow\">in</span> <span class=\"n\">commit</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"190\">            <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;&quot;</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&quot; -&gt; &quot;</span><span class=\"si\">{</span><span class=\"n\">parent</span><span class=\"si\">}</span><span class=\"s1\">&quot;</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"191\">\n</span><span class=\"line\" data-line=\"192\">    <span class=\"n\">dot</span> <span class=\"o\">+=</span> <span class=\"s1\">&#39;}&#39;</span>\n</span><span class=\"line\" data-line=\"193\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"194\">\n</span><span class=\"line\" data-line=\"195\">    <span class=\"k\">with</span> <span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">Popen</span> <span class=\"p\">(</span>\n</span><span class=\"line\" data-line=\"196\">            <span class=\"p\">[</span><span class=\"s1\">&#39;dot&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;-Tgtk&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;/dev/stdin&#39;</span><span class=\"p\">],</span>\n</span><span class=\"line\" data-line=\"197\">            <span class=\"n\">stdin</span><span class=\"o\">=</span><span class=\"n\">subprocess</span><span class=\"o\">.</span><span class=\"n\">PIPE</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">proc</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"198\">        <span class=\"n\">proc</span><span class=\"o\">.</span><span class=\"n\">communicate</span> <span class=\"p\">(</span><span class=\"n\">dot</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">())</span>\n</span><span class=\"line\" data-line=\"199\">\n</span><span class=\"line\" data-line=\"200\">\n</span><span class=\"line\" data-line=\"201\"><span class=\"k\">def</span> <span class=\"nf\">status</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"202\">    <span class=\"n\">HEAD</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_oid</span> <span class=\"p\">(</span><span class=\"s1\">&#39;@&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"203\">    <span class=\"n\">branch</span> <span class=\"o\">=</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_branch_name</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"204\">    <span class=\"k\">if</span> <span class=\"n\">branch</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"205\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;On branch </span><span class=\"si\">{</span><span class=\"n\">branch</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"206\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"207\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;HEAD detached at </span><span class=\"si\">{</span><span class=\"n\">HEAD</span><span class=\"p\">[:</span><span class=\"mi\">10</span><span class=\"p\">]</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"208\">\n</span><span class=\"line\" data-line=\"209\">    <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"s1\">&#39;</span><span class=\"se\">\\n</span><span class=\"s1\">Changes to be committed:</span><span class=\"se\">\\n</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"210\">    <span class=\"n\">HEAD_tree</span> <span class=\"o\">=</span> <span class=\"n\">HEAD</span> <span class=\"ow\">and</span> <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_commit</span> <span class=\"p\">(</span><span class=\"n\">HEAD</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">tree</span>\n</span><span class=\"line\" data-line=\"211\">    <span class=\"k\">for</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">diff</span><span class=\"o\">.</span><span class=\"n\">iter_changed_files</span> <span class=\"p\">(</span><span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_tree</span> <span class=\"p\">(</span><span class=\"n\">HEAD_tree</span><span class=\"p\">),</span>\n</span><span class=\"line\" data-line=\"212\">                                                 <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">get_working_tree</span> <span class=\"p\">()):</span>\n</span><span class=\"line\" data-line=\"213\">        <span class=\"nb\">print</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">action</span><span class=\"si\">:</span><span class=\"s1\">&gt;12</span><span class=\"si\">}</span><span class=\"s1\">: </span><span class=\"si\">{</span><span class=\"n\">path</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"214\">\n</span><span class=\"line\" data-line=\"215\">\n</span><span class=\"line\" data-line=\"216\"><span class=\"k\">def</span> <span class=\"nf\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"217\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">reset</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"218\">\n</span><span class=\"line\" data-line=\"219\">\n</span><span class=\"line\" data-line=\"220\"><span class=\"k\">def</span> <span class=\"nf\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"221\">    <span class=\"n\">base</span><span class=\"o\">.</span><span class=\"n\">merge</span> <span class=\"p\">(</span><span class=\"n\">args</span><span class=\"o\">.</span><span class=\"n\">commit</span><span class=\"p\">)</span>\n</span></code></pre></div>\n", "9224a612af2fadd5414a530a02852e457af3ad61": "<div class=\"highlight\"><pre><span></span><code><span class=\"line\" data-line=\"1\"><span class=\"kn\">import</span> <span class=\"nn\">hashlib</span>\n</span><span class=\"line\" data-line=\"2\"><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n</span><span class=\"line\" data-line=\"3\">\n</span><span class=\"line\" data-line=\"4\"><span class=\"kn\">from</span> <span class=\"nn\">collections</span> <span class=\"kn\">import</span> <span class=\"n\">namedtuple</span>\n</span><span class=\"line\" data-line=\"5\">\n</span><span class=\"line\" data-line=\"6\"><span class=\"n\">GIT_DIR</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;.ugit&#39;</span>\n</span><span class=\"line\" data-line=\"7\">\n</span><span class=\"line\" data-line=\"8\">\n</span><span class=\"line\" data-line=\"9\"><span class=\"k\">def</span> <span class=\"nf\">init</span> <span class=\"p\">():</span>\n</span><span class=\"line\" data-line=\"10\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"11\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"12\">\n</span><span class=\"line\" data-line=\"13\">\n</span><span class=\"line\" data-line=\"14\"><span class=\"n\">RefValue</span> <span class=\"o\">=</span> <span class=\"n\">namedtuple</span> <span class=\"p\">(</span><span class=\"s1\">&#39;RefValue&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;symbolic&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;value&#39;</span><span class=\"p\">])</span>\n</span><span class=\"line\" data-line=\"15\">\n</span><span class=\"line\" data-line=\"16\">\n</span><span class=\"line\" data-line=\"17\"><span class=\"k\">def</span> <span class=\"nf\">update_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"18\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"19\">\n</span><span class=\"line\" data-line=\"20\">    <span class=\"k\">assert</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"21\">    <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"22\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;ref: </span><span class=\"si\">{</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"23\">    <span class=\"k\">else</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"24\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">value</span>\n</span><span class=\"line\" data-line=\"25\">\n</span><span class=\"line\" data-line=\"26\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"27\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">makedirs</span> <span class=\"p\">(</span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">dirname</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">),</span> <span class=\"n\">exist_ok</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"28\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">,</span> <span class=\"s1\">&#39;w&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"29\">        <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"30\">\n</span><span class=\"line\" data-line=\"31\">\n</span><span class=\"line\" data-line=\"32\"><span class=\"k\">def</span> <span class=\"nf\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"33\">    <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"34\">\n</span><span class=\"line\" data-line=\"35\">\n</span><span class=\"line\" data-line=\"36\"><span class=\"k\">def</span> <span class=\"nf\">delete_ref</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"37\">    <span class=\"n\">ref</span> <span class=\"o\">=</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"38\">    <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">remove</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"39\">\n</span><span class=\"line\" data-line=\"40\">\n</span><span class=\"line\" data-line=\"41\"><span class=\"k\">def</span> <span class=\"nf\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"42\">    <span class=\"n\">ref_path</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">ref</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"43\">    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n</span><span class=\"line\" data-line=\"44\">    <span class=\"k\">if</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">isfile</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"45\">        <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"n\">ref_path</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"46\">            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"47\">\n</span><span class=\"line\" data-line=\"48\">    <span class=\"n\">symbolic</span> <span class=\"o\">=</span> <span class=\"nb\">bool</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"s1\">&#39;ref:&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"49\">    <span class=\"k\">if</span> <span class=\"n\">symbolic</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"50\">        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">split</span> <span class=\"p\">(</span><span class=\"s1\">&#39;:&#39;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">strip</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"51\">        <span class=\"k\">if</span> <span class=\"n\">deref</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"52\">            <span class=\"k\">return</span> <span class=\"n\">_get_ref_internal</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"53\">\n</span><span class=\"line\" data-line=\"54\">    <span class=\"k\">return</span> <span class=\"n\">ref</span><span class=\"p\">,</span> <span class=\"n\">RefValue</span> <span class=\"p\">(</span><span class=\"n\">symbolic</span><span class=\"o\">=</span><span class=\"n\">symbolic</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"n\">value</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"55\">\n</span><span class=\"line\" data-line=\"56\">\n</span><span class=\"line\" data-line=\"57\"><span class=\"k\">def</span> <span class=\"nf\">iter_refs</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"58\">    <span class=\"n\">refs</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s1\">&#39;HEAD&#39;</span><span class=\"p\">]</span>\n</span><span class=\"line\" data-line=\"59\">    <span class=\"k\">for</span> <span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">filenames</span> <span class=\"ow\">in</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">walk</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/refs/&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"60\">        <span class=\"n\">root</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"n\">relpath</span> <span class=\"p\">(</span><span class=\"n\">root</span><span class=\"p\">,</span> <span class=\"n\">GIT_DIR</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"61\">        <span class=\"n\">refs</span><span class=\"o\">.</span><span class=\"n\">extend</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">root</span><span class=\"si\">}</span><span class=\"s1\">/</span><span class=\"si\">{</span><span class=\"n\">name</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span> <span class=\"k\">for</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">filenames</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"62\">\n</span><span class=\"line\" data-line=\"63\">    <span class=\"k\">for</span> <span class=\"n\">refname</span> <span class=\"ow\">in</span> <span class=\"n\">refs</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"64\">        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">refname</span><span class=\"o\">.</span><span class=\"n\">startswith</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"65\">            <span class=\"k\">continue</span>\n</span><span class=\"line\" data-line=\"66\">        <span class=\"k\">yield</span> <span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">get_ref</span> <span class=\"p\">(</span><span class=\"n\">refname</span><span class=\"p\">,</span> <span class=\"n\">deref</span><span class=\"o\">=</span><span class=\"n\">deref</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"67\">\n</span><span class=\"line\" data-line=\"68\">\n</span><span class=\"line\" data-line=\"69\"><span class=\"k\">def</span> <span class=\"nf\">hash_object</span> <span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">type_</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"70\">    <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">encode</span> <span class=\"p\">()</span> <span class=\"o\">+</span> <span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span> <span class=\"o\">+</span> <span class=\"n\">data</span>\n</span><span class=\"line\" data-line=\"71\">    <span class=\"n\">oid</span> <span class=\"o\">=</span> <span class=\"n\">hashlib</span><span class=\"o\">.</span><span class=\"n\">sha1</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">hexdigest</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"72\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;wb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">out</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"73\">        <span class=\"n\">out</span><span class=\"o\">.</span><span class=\"n\">write</span> <span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"74\">    <span class=\"k\">return</span> <span class=\"n\">oid</span>\n</span><span class=\"line\" data-line=\"75\">\n</span><span class=\"line\" data-line=\"76\">\n</span><span class=\"line\" data-line=\"77\"><span class=\"k\">def</span> <span class=\"nf\">get_object</span> <span class=\"p\">(</span><span class=\"n\">oid</span><span class=\"p\">,</span> <span class=\"n\">expected</span><span class=\"o\">=</span><span class=\"s1\">&#39;blob&#39;</span><span class=\"p\">):</span>\n</span><span class=\"line\" data-line=\"78\">    <span class=\"k\">with</span> <span class=\"nb\">open</span> <span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s1\">&#39;</span><span class=\"si\">{</span><span class=\"n\">GIT_DIR</span><span class=\"si\">}</span><span class=\"s1\">/objects/</span><span class=\"si\">{</span><span class=\"n\">oid</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;rb&#39;</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"79\">        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">read</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"80\">\n</span><span class=\"line\" data-line=\"81\">    <span class=\"n\">type_</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">content</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">partition</span> <span class=\"p\">(</span><span class=\"sa\">b</span><span class=\"s1\">&#39;</span><span class=\"se\">\\x00</span><span class=\"s1\">&#39;</span><span class=\"p\">)</span>\n</span><span class=\"line\" data-line=\"82\">    <span class=\"n\">type_</span> <span class=\"o\">=</span> <span class=\"n\">type_</span><span class=\"o\">.</span><span class=\"n\">decode</span> <span class=\"p\">()</span>\n</span><span class=\"line\" data-line=\"83\">\n</span><span class=\"line\" data-line=\"84\">    <span class=\"k\">if</span> <span class=\"n\">expected</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n</span><span class=\"line\" data-line=\"85\">        <span class=\"k\">assert</span> <span class=\"n\">type_</span> <span class=\"o\">==</span> <span class=\"n\">expected</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">&#39;Expected </span><span class=\"si\">{</span><span class=\"n\">expected</span><span class=\"si\">}</span><span class=\"s1\">, got </span><span class=\"si\">{</span><span class=\"n\">type_</span><span class=\"si\">}</span><span class=\"s1\">&#39;</span>\n</span><span class=\"line\" data-line=\"86\">    <span class=\"k\">return</span> <span class=\"n\">content</span>\n</span></code></pre></div>\n"}}